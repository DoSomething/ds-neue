<!DOCTYPE html>

<html>
<head>
  <title>__location-finder.coffee</title>
  <meta http-equiv="content-type" content="text/html; charset=UTF-8">
  <meta name="viewport" content="width=device-width, target-densitydpi=160dpi, initial-scale=1.0; maximum-scale=1.0; user-scalable=0;">
  <link rel="stylesheet" media="all" href="docco.css" />
</head>
<body>
  <div id="container">
    <div id="background"></div>
    
    <ul class="sections">
        
          <li id="title">
              <div class="annotation">
                  <h1>__location-finder.coffee</h1>
              </div>
          </li>
        
        
        
        <li id="section-1">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-1">&#182;</a>
              </div>
              <p>The location finder module must be initialized before it can be used on a page. Usage:</p>
<pre><code class="lang-js">  var locFinder = window.DSLocationFinder();
  locFinder.initialize({
    mode: &#39;default&#39; or &#39;select&#39;,
    endpoint: &#39;&lt;JSON endpoint URL&gt;&#39;,
    validatoin: 

  });</code></pre>

            </div>
            
            <div class="content"><div class='highlight'><pre>
$ = jQuery

window.<span class="function"><span class="title">DSLocationFinder</span></span> = -&gt;
  initialized = <span class="literal">false</span>;
  options = {}

  <span class="function"><span class="title">findLocation</span></span> = (query) =&gt;</pre></div></div>
            
        </li>
        
        
        <li id="section-2">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-2">&#182;</a>
              </div>
              <p>If a <code>validation</code> regular expression was set, we check that before proceeding.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    <span class="keyword">if</span>(query.match(options.validation))
      $.get <span class="string">"<span class="subst">#{options.endpoint}</span><span class="subst">#{query}</span>"</span>, (data)-&gt;
        $(<span class="string">".js-location-finder-results-zip"</span>).text(query)

        $(<span class="string">".js-location-finder-results .location-list"</span>).html(<span class="string">""</span>)
        $.each(data.results, (index, value) -&gt;
          <span class="keyword">if</span>(options.mode == <span class="string">"select"</span>)
            modifier_class = <span class="string">""</span>
          <span class="keyword">else</span>
            modifier_class = <span class="string">""</span>

          $(<span class="string">".js-location-finder-results .location-list"</span>).append(<span class="string">"""
            &lt;li data-id="<span class="subst">#{@gsid}</span>" data-name="<span class="subst">#{@name}</span>"&gt;
              &lt;strong&gt;<span class="subst">#{@name}</span>&lt;/strong&gt;&lt;br&gt;
              <span class="subst">#{@street}</span>, <span class="subst">#{@city}</span>, <span class="subst">#{@state}</span> <span class="subst">#{@zip}</span>&lt;br&gt;
              <span class="subst">#{<span class="keyword">if</span> @phone? <span class="keyword">then</span> @phone + "\n" <span class="keyword">else</span> "" }</span>
            &lt;/li&gt;
            """</span>)
        )

        <span class="keyword">if</span>(options.mode == <span class="string">"select"</span>)
          list_items = $(<span class="string">".js-location-finder-results .location-list li"</span>)
          list_items.addClass(<span class="string">"js-clickable"</span>)
          list_items.click( -&gt;
            $(<span class="string">".js-location-finder-results .location-list"</span>).find(<span class="string">".js-clickable"</span>).removeClass(<span class="string">"js-selected"</span>);
            $(<span class="keyword">this</span>).addClass(<span class="string">"js-selected"</span>)

            <span class="keyword">if</span>(options.delegate?)
              options.delegate.val($(<span class="keyword">this</span>).data(<span class="string">"id"</span>))
              options.delegate.attr(<span class="string">"data-name"</span>, $(<span class="keyword">this</span>).data(<span class="string">"name"</span>))
              options.delegate.trigger(<span class="string">"change"</span>)
            <span class="keyword">else</span>
              console.error(<span class="string">"Location finder delegate not set."</span>)
          )

        $(<span class="string">".js-location-finder-form"</span>).slideUp(<span class="number">400</span>)
        $(<span class="string">".js-location-finder-results"</span>).slideDown(<span class="number">400</span>)

        bindResetButton()</pre></div></div>
            
        </li>
        
        
        <li id="section-3">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-3">&#182;</a>
              </div>
              <p>removed fail handler because jQuery 
.fail -&gt;
  $(“.js-location-finder-results”).html(&quot;<div class='alert error'>We had trouble talking to the server. Check that your internet connection is working, or try reloading the page.“);
  $(”.js-location-finder-form“).slideUp(400)
  $(”.js-location-finder-results&quot;).slideDown(400)</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    <span class="keyword">else</span>
      $(<span class="string">".js-location-finder-button"</span>).removeClass(<span class="string">"loading"</span>)
      $(<span class="string">".js-location-finder-form"</span>).append(<span class="string">"&lt;div id='js-location-finder-validation-error' class='messages error'&gt;Slow down buddy, that's not a zip code.&lt;/div&gt;"</span>).slideDown(<span class="number">400</span>)

      $(<span class="string">".js-location-finder-input"</span>).bind <span class="string">"propertychange input keyup"</span>, -&gt;
        $(<span class="string">"#js-location-finder-validation-error"</span>).delay(<span class="number">800</span>).slideUp <span class="number">400</span>, -&gt;
          $(<span class="string">"#js-location-finder-validation-error"</span>).remove()



  <span class="function"><span class="title">bindResetButton</span></span> = -&gt;</pre></div></div>
            
        </li>
        
        
        <li id="section-4">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-4">&#182;</a>
              </div>
              <p>bind reset form event</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    $(<span class="string">".js-location-finder-reset"</span>).click (e) -&gt;
      e.preventDefault()

      $(<span class="string">".js-location-finder-results"</span>).slideUp(<span class="number">400</span>)
      $(<span class="string">".js-location-finder-form"</span>).slideDown(<span class="number">400</span>)
      $(<span class="string">".js-location-finder-results .location-list"</span>).html(<span class="string">""</span>)
      $(<span class="string">".js-location-finder-button"</span>).removeClass(<span class="string">"loading"</span>)



  initialize: (opts) -&gt;
    <span class="keyword">if</span> (!initialized) 
      initialized = <span class="literal">true</span>;</pre></div></div>
            
        </li>
        
        
        <li id="section-5">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-5">&#182;</a>
              </div>
              <p>Default options can be overridden by passing JSON value in to initialize method.
- <strong>mode:</strong> either ‘default’ or ‘select’
   - ‘select’ makes results clickable, and passes the selected result to a hidden form delegate
- <strong>endpoint:</strong> JSON endpoint to connect to
- <strong>validation:</strong> regex for form validation, ex: <code>/^\d{5}$/</code>
- <strong>delegate:</strong> if in ‘select’ mode, DOM object where selected ID will be output to, ex: $(“#formID”)</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>      defaults =
        mode: <span class="string">'default'</span>,
        endpoint: <span class="string">'/example-data.json'</span>,
        validation: <span class="regexp">/[\s\S]*/</span>,
        delegate: $(<span class="string">'.js-location-finder-delegate'</span>)</pre></div></div>
            
        </li>
        
        
        <li id="section-6">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-6">&#182;</a>
              </div>
              <p>Override default options with any settings passed during initialization.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>      <span class="keyword">if</span>(opts?)
        options = $.extend({}, defaults, opts)
      <span class="keyword">else</span>
        options = defaults</pre></div></div>
            
        </li>
        
        
        <li id="section-7">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-7">&#182;</a>
              </div>
              <p>Prepare the form for use.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>      $(<span class="string">".no-js-feature-warning"</span>).hide()
      $(<span class="string">".no-js-hide-feature"</span>).show()
      $(<span class="string">".js-location-finder-results"</span>).hide()

      $(<span class="string">".js-location-finder-button"</span>).click (e) =&gt;
        e.preventDefault()
        findLocation $(<span class="string">".js-location-finder-input"</span>).val()

      $(<span class="string">".js-location-finder-form"</span>).submit (e) =&gt;
        e.preventDefault()
        findLocation $(<span class="string">".js-location-finder-input"</span>).val()</pre></div></div>
            
        </li>
        
    </ul>
  </div>
</body>
</html>
